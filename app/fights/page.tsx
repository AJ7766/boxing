import { Date } from "@/components/Fights/Date";
import { FighterName } from "@/components/Fights/FighterName";
import { FighterStats } from "@/components/Fights/FighterStats";
import { Pagination } from "@/components/Fights/Pagination";
import { rajdhani } from "@/fonts/fonts";
import { getFights, getSearchParams } from "@/services/fightsServices";

export default async function Fights({ searchParams }: { searchParams: Promise<{ [key: string]: string | string[] | undefined }> }) {
    const { page, per_page, start, end } = await getSearchParams({ searchParams })
    const { fights, totalFights } = await getFights(start, end);

    if (!fights)
        return <p>No fights found</p>;

    return (
        <main className={`${rajdhani.className} bg-white text-lg whitespace-nowrap flex flex-col gap-20 py-12`}>
            {fights.map((fight, i) => (
                <div className={`max-w-[850px] w-full mx-auto flex flex-col items-center gap-2`} key={i}>
                    {/* TITLE */}
                    <div className="w-full grid grid-cols-[20%_60%_20%] items-center">
                        <div>
                            <FighterName name={fight.fighter1?.name || fight.fighter1?.nickname} />
                            <FighterStats stats={`${fight.fighter1?.wins}-${fight.fighter1?.losses || 0}-${fight.fighter1?.draws || 0}`} />
                        </div>
                        <div className="flex flex-col justify-between text-center">
                            <div>
                                {/* DATE */}
                                <Date date={fight.date?.toISOString()} />
                                {/* LOCATION */}
                                <p className="text-lg font-medium text-gray-500 border-b mb-2">{fight.location}</p>
                                {/* ROUNDS @ DIVISION */}
                                <p className="text-red-700 text-lg font-semibold">{fight.scheduledRounds} ROUNDS @ {fight.divisionName}</p>
                                {/* BELTS IN PLAY */}
                                {fight.titles.map((title) => (
                                    <p className="text-[#804A00] text-base font-medium" key={title.id}>{title.name}</p>
                                ))}
                            </div>
                        </div>
                        <div className="text-right">
                            <FighterName name={fight.fighter2?.name || fight.fighter2?.nickname} />
                            <FighterStats stats={`${fight.fighter1?.wins}-${fight.fighter1?.losses || 0}-${fight.fighter1?.draws || 0}`} />
                        </div>
                    </div>
                </div>
            ))}
            <Pagination
                page={page}
                per_page={per_page}
                hasPrevPage={start > 1}
                hasNextPage={end < totalFights}
                totalFights={totalFights}
            />
        </main>
    )
}

export const metadata = {
    title: "Fights - Boxing",
    description: "Generated by create next app",
};